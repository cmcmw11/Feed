<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>โปรไฟล์ - โลกสวย Social</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<style>
body{
  font-family: 'Kanit', sans-serif;
  background: linear-gradient(135deg, #ffd6f6, #d6eaff, #e8d6ff);
  margin:0; padding:0; display:flex; justify-content:center; align-items:flex-start; min-height:100vh;
}
.container{
  width: 400px; background:white; border-radius:20px; padding:25px; margin-top:30px;
  box-shadow:0 4px 20px rgba(0,0,0,0.15);
}
h2{text-align:center;color:#555;margin-bottom:15px;}
.profile-pic{
  width:120px; height:120px; border-radius:50%; background:#eee; margin:0 auto 15px; display:block; object-fit:cover;
  border:3px solid #ff80c0;
}
input, textarea, select{
  width:100%; padding:10px; margin:8px 0; border-radius:10px; border:1px solid #ddd;
}
button{
  width:100%; padding:12px; border:none; border-radius:12px; cursor:pointer; margin-top:8px; font-size:16px;
}
.btn-edit{background:#7caeff;color:white;}
.btn-edit:hover{background:#5c8cff;}
.popup-menu{
  position:relative; text-align:right; margin-bottom:10px;
}
.menu-content{
  display:none; position:absolute; right:0; background:#fff; border:1px solid #ddd; border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,0.15); overflow:hidden;
}
.menu-content button{
  display:block; width:100%; padding:10px; border:none; background:none; text-align:left; cursor:pointer;
}
.menu-content button:hover{background:#f0f0f0;}
</style>
</head>
<body>
<div class="container">
  <h2>โปรไฟล์ของคุณ</h2>

  <div class="popup-menu">
    <button id="menuBtn">⋮ ตัวเลือก</button>
    <div class="menu-content" id="menuContent">
      <button onclick="goMyPosts()">ดูโพสต์ของฉัน</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <img src="Profilepic.png" id="profilePic" class="profile-pic">

  <h3>ข้อมูลผู้ใช้</h3>
  <p>Username: <span id="profileName"></span></p>
  <p>เพศ: <span id="profileGender"></span></p>
  <p>วันเกิด: <span id="profileBirthdate"></span></p>
  <p>Bio: <span id="profileBio"></span></p>

  <h3>แก้ไขโปรไฟล์</h3>
  <input type="text" id="newUsername" placeholder="แก้ไขชื่อผู้ใช้">
  <textarea id="bio" placeholder="แก้ไขแนะนำตัว"></textarea>
  <button class="btn-edit" id="saveProfileBtn">บันทึกโปรไฟล์</button>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCXcq9coy4Ah39DTzN9OmZc-nm8JBHPapA",
  authDomain: "feed-32f94.firebaseapp.com",
  projectId: "feed-32f94",
  storageBucket: "feed-32f94.appspot.com",
  messagingSenderId: "939495314483",
  appId: "1:939495314483:web:2eacab83fb89a67812ff46",
  measurementId: "G-M5T6KE9YSE"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

// Menu toggle
document.getElementById('menuBtn').addEventListener('click',()=>{
  const menu = document.getElementById('menuContent');
  menu.style.display = menu.style.display==='block'?'none':'block';
});

function goMyPosts(){ window.location.href="myposts.html"; }
function logout(){ auth.signOut(); window.location.href="login.html"; }

// Load profile
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="login.html";
  else{
    currentUser = user;
    loadProfile(user.uid);
  }
});

function loadProfile(uid){
  db.collection("users").doc(uid).get().then(doc=>{
    const data = doc.data();
    if(!data){ alert("เกิดข้อผิดพลาด: ไม่พบข้อมูลผู้ใช้"); return; }
    document.getElementById('profileName').innerText = "@"+data.username;
    document.getElementById('profileGender').innerText = data.gender;
    document.getElementById('profileBirthdate').innerText = data.birthdate;
    document.getElementById('profileBio').innerText = data.bio || "";
    document.getElementById('newUsername').value = data.username;
    document.getElementById('bio').value = data.bio || "";
  });
}

// Save profile
document.getElementById('saveProfileBtn').addEventListener('click',()=>{
  if(!currentUser) return alert("ยังไม่ได้ login");
  const newUsername = document.getElementById('newUsername').value.trim();
  const bio = document.getElementById('bio').value.trim();
  db.collection("users").doc(currentUser.uid).update({
    username: newUsername,
    bio: bio
  }).then(()=>{ alert("อัปเดตโปรไฟล์เรียบร้อย ✅"); loadProfile(currentUser.uid); })
  .catch(err=>{ alert("ไม่สามารถบันทึกได้: "+err.message); });
});
</script>
</body>
</html>
