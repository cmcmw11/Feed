<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå - ‡πÇ‡∏•‡∏Å‡∏™‡∏ß‡∏¢ Social</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap');
  body {
    font-family: 'Quicksand', sans-serif;
    background: #f0f2f5;
    margin: 0; padding: 0;
    display: flex; justify-content: center; padding-top: 30px;
  }
  .container {
    width: 400px; background: #fff; border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 20px;
  }
  .profile-header {
    display: flex; align-items: center;
    margin-bottom: 15px;
  }
  .profile-header img {
    width: 80px; height: 80px; border-radius: 50%;
    object-fit: cover; margin-right: 15px;
  }
  .profile-header h2 { margin: 0; font-size: 24px; color: #333; }
  .profile-info p {
    margin: 5px 0; color: #555;
  }
  textarea, input[type="text"] {
    width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ddd;
    margin: 5px 0; font-size: 14px;
  }
  .btn-edit, .btn-popup {
    padding: 10px 15px; border: none; border-radius: 10px; cursor: pointer;
    margin-top: 8px; font-size: 14px;
  }
  .btn-edit { background: #7caeff; color: white; }
  .btn-edit:hover { background: #5c8cff; }
  .popup-menu {
    display: none; position: absolute; background: #fff;
    border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 10px; margin-top: 5px;
  }
  .popup-menu button {
    width: 100%; margin: 3px 0; background: #f0f0f0; border-radius: 8px;
  }
  .emoji-bar {
    display: flex; justify-content: space-around; margin-top: 15px;
  }
  .emoji-bar span {
    font-size: 24px; cursor: pointer;
  }
</style>
</head>
<body>
<div class="container">
  <div class="profile-header">
    <img src="profilepic.png" alt="Profile Picture">
    <h2 id="profileName">@Username</h2>
    <button class="btn-popup" onclick="togglePopup()">‚öôÔ∏è</button>
    <div class="popup-menu" id="popupMenu">
      <button onclick="goMyPosts()">‡∏î‡∏π‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
      <button onclick="editProfile()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="profile-info">
    <p>‡πÄ‡∏û‡∏®: <span id="profileGender"></span></p>
    <p>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î: <span id="profileBirthdate"></span></p>
    <p>Bio: <span id="profileBio"></span></p>
  </div>

  <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
  <input type="text" id="newUsername" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
  <textarea id="bio" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß"></textarea>
  <button class="btn-edit" id="saveProfileBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>

  <div class="emoji-bar">
    <span>üå∏</span>
    <span>üíñ</span>
    <span>‚ú®</span>
    <span>üåà</span>
  </div>
</div>

<script>
  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyCXcq9coy4Ah39DTzN9OmZc-nm8JBHPapA",
    authDomain: "feed-32f94.firebaseapp.com",
    projectId: "feed-32f94",
    storageBucket: "feed-32f94.appspot.com",
    messagingSenderId: "939495314483",
    appId: "1:939495314483:web:2eacab83fb89a67812ff46",
    measurementId: "G-M5T6KE9YSE"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;

  auth.onAuthStateChanged(user=>{
    if(!user) window.location.href="login.html";
    currentUser = user;
    loadProfile(user.uid);
  });

  function loadProfile(uid){
    db.collection("users").doc(uid).get().then(doc=>{
      const data = doc.data();
      if(!data){ alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"); return; }
      document.getElementById('profileName').innerText = "@"+data.username;
      document.getElementById('profileGender').innerText = data.gender;
      document.getElementById('profileBirthdate').innerText = data.birthdate;
      document.getElementById('profileBio').innerText = data.bio || "";
      document.getElementById('newUsername').value = data.username;
      document.getElementById('bio').value = data.bio || "";
    });
  }

  document.getElementById('saveProfileBtn').addEventListener('click', ()=>{
    const newUsername = document.getElementById('newUsername').value.trim();
    const bio = document.getElementById('bio').value.trim();
    if(!currentUser) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login");
    db.collection("users").doc(currentUser.uid).update({
      username: newUsername,
      bio: bio
    }).then(()=>{ alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ"); loadProfile(currentUser.uid); })
      .catch(err=>{ alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ: "+err.message); });
  });

  function togglePopup(){
    const menu = document.getElementById('popupMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  }

  function goMyPosts(){ window.location.href="myposts.html"; }
  function editProfile(){ alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á"); }
  function logout(){ auth.signOut(); window.location.href="login.html"; }
</script>
</body>
</html>
