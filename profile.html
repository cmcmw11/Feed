<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå - ‡πÇ‡∏•‡∏Å‡∏™‡∏ß‡∏¢ Social</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap');
body { font-family: 'Quicksand', sans-serif; background:#f0f2f5; margin:0; padding:0; display:flex; justify-content:center; padding-top:30px; }
.container { width:400px; background:#fff; border-radius:15px; padding:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
.profile-header { display:flex; align-items:center; margin-bottom:15px; position:relative; }
.profile-header img { width:80px; height:80px; border-radius:50%; object-fit:cover; margin-right:15px; }
.profile-header h2 { margin:0; font-size:24px; color:#333; }
.btn-popup { margin-left:auto; border:none; background:none; font-size:20px; cursor:pointer; }
.popup-menu { display:none; position:absolute; right:0; top:40px; background:#fff; border:1px solid #ccc; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); padding:10px; }
.popup-menu button { width:100%; margin:3px 0; background:#f0f0f0; border-radius:8px; padding:8px; cursor:pointer; }
.profile-info p { margin:5px 0; color:#555; }
input, textarea { width:100%; padding:10px; margin:5px 0; border-radius:10px; border:1px solid #ddd; font-size:14px; display:none; } /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
.btn-edit { padding:10px 15px; border:none; border-radius:10px; cursor:pointer; margin-top:8px; font-size:14px; background:#7caeff; color:white; display:none; }
.emoji-bar { display:flex; justify-content:space-around; margin-top:15px; }
.emoji-bar span { font-size:28px; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
  <div class="profile-header">
    <img src="profilepic.png" alt="Profile Picture">
    <h2 id="profileName">@Username</h2>
    <button class="btn-popup" onclick="togglePopup()">‚öôÔ∏è</button>
    <div class="popup-menu" id="popupMenu">
      <button onclick="showEditProfile()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
    </div>
  </div>

  <div class="profile-info">
    <p>‡πÄ‡∏û‡∏®: <span id="profileGender"></span></p>
    <p>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î: <span id="profileBirthdate"></span></p>
    <p>Bio: <span id="profileBio"></span></p>
  </div>

  <input type="text" id="newUsername" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
  <textarea id="bio" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß"></textarea>
  <button class="btn-edit" id="saveProfileBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>

  <div class="emoji-bar">
    <span onclick="goFeed()">üå∏</span>
    <span onclick="goMyPosts()">üíñ</span>
    <span onclick="goProfile()">‚ú®</span>
    <span onclick="logout()">üåà</span>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCXcq9coy4Ah39DTzN9OmZc-nm8JBHPapA",
  authDomain: "feed-32f94.firebaseapp.com",
  projectId: "feed-32f94",
  storageBucket: "feed-32f94.appspot.com",
  messagingSenderId: "939495314483",
  appId: "1:939495314483:web:2eacab83fb89a67812ff46",
  measurementId: "G-M5T6KE9YSE"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let currentUser = null;

auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="login.html";
  currentUser = user;
  loadProfile(user.uid);
});

function loadProfile(uid){
  db.collection("users").doc(uid).get().then(doc=>{
    const data = doc.data();
    if(!data){ alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"); return; }
    document.getElementById('profileName').innerText = "@"+data.username;
    document.getElementById('profileGender').innerText = data.gender;
    document.getElementById('profileBirthdate').innerText = data.birthdate;
    document.getElementById('profileBio').innerText = data.bio || "";
    document.getElementById('newUsername').value = data.username;
    document.getElementById('bio').value = data.bio || "";
  });
}

// Toggle Pop-up menu
function togglePopup(){
  const menu = document.getElementById('popupMenu');
  menu.style.display = menu.style.display==='block' ? 'none' : 'block';
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
function showEditProfile(){
  document.getElementById('newUsername').style.display = 'block';
  document.getElementById('bio').style.display = 'block';
  document.getElementById('saveProfileBtn').style.display = 'block';
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
document.getElementById('saveProfileBtn').addEventListener('click', ()=>{
  const newUsername = document.getElementById('newUsername').value.trim();
  const bio = document.getElementById('bio').value.trim();
  if(!currentUser) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login");
  db.collection("users").doc(currentUser.uid).update({
    username: newUsername,
    bio: bio
  }).then(()=>{
    alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
    loadProfile(currentUser.uid);
    document.getElementById('newUsername').style.display='none';
    document.getElementById('bio').style.display='none';
    document.getElementById('saveProfileBtn').style.display='none';
  }).catch(err=>{ alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ: "+err.message); });
});

// Emoji navigation
function goFeed(){ window.location.href="feed.html"; }
function goMyPosts(){ window.location.href="myposts.html"; }
function goProfile(){ alert("‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß"); }
function logout(){ auth.signOut(); window.location.href="login.html"; }
</script>
</body>
</html>
