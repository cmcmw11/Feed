<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ค้นหาเพื่อน - โลกสวย Social</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap');
body { font-family:'Quicksand',sans-serif; background:#f0f2f5; margin:0; padding:20px; display:flex; justify-content:center; }
.container { width:400px; }
.card { background:#fff; border-radius:15px; padding:15px; margin-bottom:15px; box-shadow:0 4px 10px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
button { border:none; border-radius:10px; padding:5px 10px; cursor:pointer; }
button:hover { opacity:0.8; background:#7caeff; color:white; }
</style>
</head>
<body>
<div class="container">
  <h2>ผลลัพธ์การค้นหาเพื่อน</h2>
  <div id="friendsList"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCXcq9coy4Ah39DTzN9OmZc-nm8JBHPapA",
  authDomain: "feed-32f94.firebaseapp.com",
  projectId: "feed-32f94",
  storageBucket: "feed-32f94.appspot.com",
  messagingSenderId: "939495314483",
  appId: "1:939495314483:web:2eacab83fb89a67812ff46",
  measurementId: "G-M5T6KE9YSE"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const searchQuery = urlParams.get('search')?.replace("@","").toLowerCase();

const friendsDiv = document.getElementById('friendsList');

if(searchQuery){
  db.collection("users").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const data = doc.data();
      if(data.username.toLowerCase().includes(searchQuery)){
        const card = document.createElement('div');
        card.className = "card";
        card.innerHTML = `
          <span>@${data.username}</span>
          <button onclick="viewProfile('${doc.id}')">ดูโปรไฟล์</button>
        `;
        friendsDiv.appendChild(card);
      }
    });
  });
} else {
  friendsDiv.innerHTML="<p>กรุณากลับไปพิมพ์ค้นหาเพื่อนใน feed.html</p>";
}

function viewProfile(uid){
  // ไปยัง profile ของเพื่อน
  window.location.href = "friendprofile.html?uid="+uid;
}
</script>
</body>
</html>
