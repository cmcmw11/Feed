<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>WorldBright</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<style>
body{font-family:sans-serif;padding:20px;}
input,textarea,select,button{display:block;margin:5px 0;}
#feed{margin-top:20px;}
.post{border:1px solid #ccc;padding:10px;margin:10px 0;}
.repost-btn{margin-top:5px;cursor:pointer;color:blue;}
</style>
</head>
<body>

<!-- สมัครสมาชิก -->
<div id="registerPage">
  <h2>สมัครสมาชิก</h2>
  <form id="registerForm">
    <input type="text" id="regUsername" placeholder="Username" required>
    <input type="password" id="regPassword" placeholder="Password" required>
    <select id="regGender">
      <option value="male">ชาย</option>
      <option value="female">หญิง</option>
      <option value="other">อื่นๆ</option>
    </select>
    <input type="date" id="regBirthdate" required>
    <button type="submit">สมัครสมาชิก</button>
  </form>
</div>

<!-- หน้าหลังสมัครสมาชิก -->
<div id="welcomePage" style="display:none;">
  <h2>สมัครสมาชิกเรียบร้อย 🎉</h2>
  <p id="welcomeInfo"></p>
  <button onclick="goLogin()">ไปหน้าเข้าสู่ระบบ</button>
</div>

<!-- เข้าสู่ระบบ -->
<div id="loginPage">
  <h2>เข้าสู่ระบบ</h2>
  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
</div>

<!-- หน้าหลังเข้าสู่ระบบ -->
<div id="profilePage" style="display:none;">
  <h2>สวัสดี <span id="profileName"></span> 👋</h2>
  <p>เพศ: <span id="profileGender"></span></p>
  <p>วันเกิด: <span id="profileBirthdate"></span></p>
  <button onclick="showFeed()">ไปที่ Feed</button>
  <button id="logoutBtn">Logout</button>
</div>

<!-- หน้า Feed -->
<div id="feed" style="display:none;">
  <h2>Feed</h2>
  <form id="postForm">
    <textarea id="postText" placeholder="เขียนโพสต์..."></textarea>
    <input type="text" id="postHashtag" placeholder="#hashtag">
    <button type="submit">โพสต์</button>
  </form>
  <div id="posts"></div>
</div>

<script>
// --- Register ---
document.getElementById('registerForm').addEventListener('submit', e=>{
  e.preventDefault();
  const username=document.getElementById('regUsername').value;
  const password=document.getElementById('regPassword').value;
  const gender=document.getElementById('regGender').value;
  const birthdate=document.getElementById('regBirthdate').value;

  auth.createUserWithEmailAndPassword(username+'@example.com', password)
    .then(userCredential=>{
      const user=userCredential.user;
      db.collection('users').doc(user.uid).set({username, gender, birthdate});
      // ไปหน้า welcome
      document.getElementById('registerPage').style.display='none';
      document.getElementById('welcomePage').style.display='block';
      document.getElementById('welcomeInfo').innerText=`ชื่อ: ${username}, เพศ: ${gender}, วันเกิด: ${birthdate}`;
    })
    .catch(err=>alert(err.message));
});

// --- หลังสมัคร: ไปหน้า login ---
function goLogin(){
  document.getElementById('welcomePage').style.display='none';
  document.getElementById('loginPage').style.display='block';
}

// --- Login ---
document.getElementById('loginForm').addEventListener('submit', e=>{
  e.preventDefault();
  const username=document.getElementById('loginUsername').value;
  const password=document.getElementById('loginPassword').value;
  auth.signInWithEmailAndPassword(username+'@example.com', password)
    .then(userCredential=>{
      const user=userCredential.user;
      // ดึงข้อมูล user
      db.collection('users').doc(user.uid).get().then(doc=>{
        const data=doc.data();
        document.getElementById('loginPage').style.display='none';
        document.getElementById('profilePage').style.display='block';
        document.getElementById('profileName').innerText=data.username;
        document.getElementById('profileGender').innerText=data.gender;
        document.getElementById('profileBirthdate').innerText=data.birthdate;
      });
    })
    .catch(err=>alert(err.message));
});

// --- ไปหน้า Feed ---
function showFeed(){
  document.getElementById('profilePage').style.display='none';
  document.getElementById('feed').style.display='block';
  listenPosts();
}

// --- Logout ---
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  auth.signOut();
  document.getElementById('profilePage').style.display='none';
  document.getElementById('loginPage').style.display='block';
});
</script>
</body>

</body>
</html>
