<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>WorldBright</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<style>
body{font-family:sans-serif;padding:20px;}
input,textarea,select,button{display:block;margin:5px 0;}
#feed{margin-top:20px;}
.post{border:1px solid #ccc;padding:10px;margin:10px 0;}
.repost-btn{margin-top:5px;cursor:pointer;color:blue;}
</style>
</head>
<body>

<!-- à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸ -->
<div id="registerPage">
  <h2>à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸</h2>
  <form id="registerForm">
    <input type="text" id="regUsername" placeholder="Username" required>
    <input type="password" id="regPassword" placeholder="Password" required>
    <select id="regGender">
      <option value="male">à¸Šà¸²à¸¢</option>
      <option value="female">à¸«à¸à¸´à¸‡</option>
      <option value="other">à¸­à¸·à¹ˆà¸™à¹†</option>
    </select>
    <input type="date" id="regBirthdate" required>
    <button type="submit">à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸</button>
  </form>
</div>

<!-- à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸‡à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸ -->
<div id="welcomePage" style="display:none;">
  <h2>à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ ğŸ‰</h2>
  <p id="welcomeInfo"></p>
  <button onclick="goLogin()">à¹„à¸›à¸«à¸™à¹‰à¸²à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
</div>

<!-- à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š -->
<div id="loginPage">
  <h2>à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</h2>
  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
</div>

<!-- à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸‡à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š -->
<div id="profilePage" style="display:none;">
  <h2>à¸ªà¸§à¸±à¸ªà¸”à¸µ <span id="profileName"></span> ğŸ‘‹</h2>
  <p>à¹€à¸à¸¨: <span id="profileGender"></span></p>
  <p>à¸§à¸±à¸™à¹€à¸à¸´à¸”: <span id="profileBirthdate"></span></p>
  <button onclick="showFeed()">à¹„à¸›à¸—à¸µà¹ˆ Feed</button>
  <button id="logoutBtn">Logout</button>
</div>

<!-- à¸«à¸™à¹‰à¸² Feed -->
<div id="feed" style="display:none;">
  <h2>Feed</h2>
  <form id="postForm">
    <textarea id="postText" placeholder="à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸à¸ªà¸•à¹Œ..."></textarea>
    <input type="text" id="postHashtag" placeholder="#hashtag">
    <button type="submit">à¹‚à¸à¸ªà¸•à¹Œ</button>
  </form>
  <div id="posts"></div>
</div>

<script>
// --- Register ---
document.getElementById('registerForm').addEventListener('submit', e=>{
  e.preventDefault();
  const username=document.getElementById('regUsername').value;
  const password=document.getElementById('regPassword').value;
  const gender=document.getElementById('regGender').value;
  const birthdate=document.getElementById('regBirthdate').value;

  auth.createUserWithEmailAndPassword(username+'@example.com', password)
    .then(userCredential=>{
      const user=userCredential.user;
      db.collection('users').doc(user.uid).set({username, gender, birthdate});
      // à¹„à¸›à¸«à¸™à¹‰à¸² welcome
      document.getElementById('registerPage').style.display='none';
      document.getElementById('welcomePage').style.display='block';
      document.getElementById('welcomeInfo').innerText=`à¸Šà¸·à¹ˆà¸­: ${username}, à¹€à¸à¸¨: ${gender}, à¸§à¸±à¸™à¹€à¸à¸´à¸”: ${birthdate}`;
    })
    .catch(err=>alert(err.message));
});

// --- à¸«à¸¥à¸±à¸‡à¸ªà¸¡à¸±à¸„à¸£: à¹„à¸›à¸«à¸™à¹‰à¸² login ---
function goLogin(){
  document.getElementById('welcomePage').style.display='none';
  document.getElementById('loginPage').style.display='block';
}

// --- Login ---
document.getElementById('loginForm').addEventListener('submit', e=>{
  e.preventDefault();
  const username=document.getElementById('loginUsername').value;
  const password=document.getElementById('loginPassword').value;
  auth.signInWithEmailAndPassword(username+'@example.com', password)
    .then(userCredential=>{
      const user=userCredential.user;
      // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ user
      db.collection('users').doc(user.uid).get().then(doc=>{
        const data=doc.data();
        document.getElementById('loginPage').style.display='none';
        document.getElementById('profilePage').style.display='block';
        document.getElementById('profileName').innerText=data.username;
        document.getElementById('profileGender').innerText=data.gender;
        document.getElementById('profileBirthdate').innerText=data.birthdate;
      });
    })
    .catch(err=>alert(err.message));
});

// --- à¹„à¸›à¸«à¸™à¹‰à¸² Feed ---
function showFeed(){
  document.getElementById('profilePage').style.display='none';
  document.getElementById('feed').style.display='block';
  listenPosts();
}

// --- Logout ---
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  auth.signOut();
  document.getElementById('profilePage').style.display='none';
  document.getElementById('loginPage').style.display='block';
});
</script>
</body>

</body>
</html>
