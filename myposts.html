<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô - ‡πÇ‡∏•‡∏Å‡∏™‡∏ß‡∏¢ Social</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #ffd6f6, #d6eaff, #e8d6ff);
      min-height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      padding: 20px 0;
    }
    .container {
      max-width: 500px;
      width: 100%;
      padding: 20px;
    }
    h2 { text-align: center; color: #555; margin-bottom: 20px; }
    .post {
      background: white; border-radius: 15px; padding: 15px;
      margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .actions button {
      margin-right: 8px; padding: 6px 12px; border: none; border-radius: 10px; cursor: pointer; color: white;
    }
    .btn-edit { background: #7caeff; }
    .btn-edit:hover { background: #5c8cff; }
    .btn-delete { background: #ff6b6b; }
    .btn-delete:hover { background: #ff4a4a; }
    .btn-repost { background: #d6a5ff; }
    .btn-repost:hover { background: #c184ff; }
    .back-btn { margin-bottom: 10px; padding: 10px 15px; background: #ff80c0; color: white; border: none; border-radius: 12px; cursor: pointer;}
    .back-btn:hover { background: #ff5aa0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
    <button class="back-btn" onclick="goFeed()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Feed</button>
    <div id="myposts"></div>
  </div>

  <script>
    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyCXcq9coy4Ah39DTzN9OmZc-nm8JBHPapA",
      authDomain: "feed-32f94.firebaseapp.com",
      projectId: "feed-32f94",
      storageBucket: "feed-32f94.appspot.com",
      messagingSenderId: "939495314483",
      appId: "1:939495314483:web:2eacab83fb89a67812ff46",
      measurementId: "G-M5T6KE9YSE"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö login ---
    auth.onAuthStateChanged(user=>{
      if(!user) window.location.href="login.html";
      else listenMyPosts(user.uid);
    });

    // --- ‡∏Å‡∏•‡∏±‡∏ö Feed ---
    function goFeed(){ window.location.href="feed.html"; }

    // --- Listen Posts ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ---
    function listenMyPosts(uid){
      db.collection("posts")
        .where("user_id","==",uid)
        .orderBy("timestamp","desc")
        .onSnapshot(snapshot=>{
          const div = document.getElementById('myposts');
          div.innerHTML="";
          snapshot.forEach(doc=>{
            const p = doc.data();
            const postDiv = document.createElement('div');
            postDiv.className="post";
            postDiv.innerHTML=`
              <p><strong>@${p.username}</strong></p>
              <p id="text-${doc.id}">${p.text}</p>
              <p style="color:#888;">${(p.hashtags||[]).join(" ")}</p>
              <div class="actions">
                <button class="btn-edit" onclick="editPost('${doc.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button class="btn-delete" onclick="deletePost('${doc.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
                <button class="btn-repost" onclick="repostPost('${doc.id}')">üîÅ ‡∏£‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
              </div>
            `;
            div.appendChild(postDiv);
          });
        });
    }

    // --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏û‡∏™‡∏ï‡πå ---
    function editPost(id){
      const textEl = document.getElementById('text-'+id);
      const newText = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå:", textEl.innerText);
      if(newText){
        db.collection("posts").doc(id).update({text:newText});
      }
    }

    // --- ‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå ---
    function deletePost(id){
      if(confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ?")){
        db.collection("posts").doc(id).delete();
      }
    }

    // --- ‡∏£‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå ---
    function repostPost(id){
      const user = auth.currentUser;
      if(!user) return;
      db.collection("posts").doc(id).get().then(doc=>{
        const data = doc.data();
        db.collection("posts").add({
          user_id:user.uid,
          username:data.username,
          text:data.text,
          hashtags:data.hashtags,
          timestamp:firebase.firestore.FieldValue.serverTimestamp(),
          likes:0,
          reposts:0,
          repost_from:id
        });
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° count repost ‡∏Ç‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
        db.collection("posts").doc(id).update({
          reposts: firebase.firestore.FieldValue.increment(1)
        });
        alert("‡∏£‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      });
    }
  </script>
</body>
</html>
